<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo</title>
    <script type="module" src="../dist/mapml-viewer.js"></script>
    <link rel="stylesheet" href="embeded-demo-style.css"/>

    <link rel="stylesheet" href="codemirror-5.64.0/lib/codemirror.css">
    <script src="codemirror-5.64.0/lib/codemirror.js"></script>
    <script src="codemirror-5.64.0/mode/xml/xml.js"></script>
    <script src="codemirror-5.64.0/mode/css/css.js"></script>
    <script src="codemirror-5.64.0/mode/javascript/javascript.js"></script>
    <script src="codemirror-5.64.0/addon/edit/closetag.js"></script>

</head>
<body>
    <div style="text-align: center;">
        <!------------------------------------------------- CHANGE THIS ------------------------------------------------->
        <h2>MapML Demo: &lt;map-feature&gt;</h2>
        <button class="run" onclick="plot()" aria-label="run code"><span aria-hidden="true">â–¶</span></button>
    </div>

    <div class="tab">
        <button id="default" class="tablinks" onclick="switchTab(event, 'HTML')">HTML</button>
        <button class="tablinks" onclick="switchTab(event, 'CSS')">CSS</button>
    </div>

    <div class="tabcontent" id="HTML">
        <!------------------------------------------------- CHANGE THIS ------------------------------------------------->
        <textarea rows="10" style="width:100%" id="htmlEditor">
<mapml-viewer projection="CBMTILE" zoom="1" lat="45.5052040" lon="-75.2202344" controls>
  <layer- label="Arizona" checked>
    <map-meta name="projection" content="CBMTILE"></map-meta>
    <map-meta name="zoom" content="min=1,max=5,value=0"></map-meta>
    <map-meta name="cs" content="gcrs"></map-meta>
    <map-meta name="extent" content="zoom=0,top-left-column=0,top-left-row=0,bottom-right-column=5,bottom-right-row=5"></map-meta>

    <map-feature zoom="2" class="refDiff1">
      <map-featurecaption>Feature 1</map-featurecaption>
      <map-properties>
        <h1>Test</h1>
        <a href="http://example.org/" target="_blank">test</a>
      </map-properties>
      <map-geometry cs="tilematrix">
        <map-polygon>
          <map-coordinates>11 11 12 11 12 12 11 12</map-coordinates>
        </map-polygon>
      </map-geometry>
    </map-feature>

    <map-feature zoom="2" class="refDiff2">
      <map-featurecaption>Feature 2</map-featurecaption>
      <map-properties>
        <h1>Test</h1>
      </map-properties>
      <map-geometry cs="pcrs">
        <map-polygon>
          <map-coordinates>257421 -3567196 -271745 1221771 -3896544 242811 -3183549 -2613313</map-coordinates>
        </map-polygon>
      </map-geometry>
    </map-feature>

    <map-feature zoom="2" class="refDiff3">
      <map-featurecaption>Feature 3</map-featurecaption>
      <map-properties>
        <h1>Test</h1>
      </map-properties>
      <map-geometry cs="tcrs">
        <map-polygon>
          <map-coordinates>2771 3106 2946 3113 2954 3210 2815 3192</map-coordinates>
        </map-polygon>
      </map-geometry>
    </map-feature>

    <map-feature zoom="2" class="refDiff4">
      <map-featurecaption>Feature 4</map-featurecaption>
      <map-properties>
        <h1>Arizona</h1>
      </map-properties>
      <map-geometry>
        <map-polygon>
          <map-coordinates>-109.042503 37.000263 -109.04798 31.331629 -111.074448 31.331629 -112.246513 31.704061
            -114.815198 32.492741 -114.72209 32.717295 -114.524921 32.755634 -114.470151 32.843265 -114.524921
            33.029481 -114.661844 33.034958 -114.727567 33.40739 -114.524921 33.54979 -114.497536 33.697668
            -114.535874 33.933176 -114.415382 34.108438 -114.256551 34.174162 -114.136058 34.305608 -114.333228
            34.448009 -114.470151 34.710902 -114.634459 34.87521 -114.634459 35.00118 -114.574213 35.138103
            -114.596121 35.324319 -114.678275 35.516012 -114.738521 36.102045 -114.371566 36.140383 -114.251074
            36.01989 -114.152489 36.025367 -114.048427 36.195153 -114.048427 37.000263 -110.499369 37.00574
            -109.042503 37.000263</map-coordinates>
        </map-polygon>
      </map-geometry>
    </map-feature>
  </layer->
</mapml-viewer></textarea>
    </div>
    <div class="tabcontent" id="CSS">
        <!------------------------------------------------- CHANGE THIS ------------------------------------------------->
        <textarea rows="10" style="width:100%" id="cssEditor">
.refDiff1 {
  fill: #A0DDE6;
  stroke: #80C2AF;
}
.refDiff2 {
  fill: #FFD639;
  stroke: #FBAF00;
}
.refDiff3 {
  fill: #E1AA7D;
  stroke: #B6D094;
}
.refDiff4 {
  fill: #D8A47F;
  stroke: #EF8354;
}</textarea>
    </div>

    <div id="output"></div>

    <script>
        // Styling HTML Text Editor
        var htmlEditor = CodeMirror.fromTextArea(document.getElementById('htmlEditor'), {
            mode: "xml",
            //lineNumbers: true,
            screenReaderLabel: "MapML Demo Code",
            tabSize: 2,
            autoCloseTags: true
        });

        // Styling CSS Text Editor
        var cssEditor = CodeMirror.fromTextArea(document.getElementById('cssEditor'), {
            mode: "css",
            //lineNumbers: true,
            screenReaderLabel: "MapML Demo Code",
            tabSize: 2,
            autoCloseTags: true
        });

        // Plot the new mapml map when run button is clicked
        function plot() {
            let parser = new DOMParser();

            // HTML Parsing and implementing
            let rawText = htmlEditor.getValue();

            let mapml = parser.parseFromString(rawText, "text/html");
            mapml = mapml.querySelector('mapml-viewer');

            // CSS Parsing and implementing
            let rawTextCSS = cssEditor.getValue();

            let mapmlCSS = parser.parseFromString("<map-style>" + rawTextCSS + "</map-style>", "text/xml").querySelector('map-style');

            // Adding the CSS to each layer
            let layers = mapml.querySelectorAll('layer-');
            for (i=0; i<layers.length; ++i) {
                layers[i].appendChild(mapmlCSS);
            }

            console.log(layers);

            // Adding code to output div
            let output = document.getElementById('output');
            output.replaceChild(mapml, output.querySelector('mapml-viewer'));
        }

        // Plot map when page is loaded using the deafult text
        window.onload = (event) => {
            let parser = new DOMParser();

            // HTML Parsing and implementing
            let rawText = htmlEditor.getValue();
            let mapml = parser.parseFromString(rawText, "text/html");
            mapml = mapml.querySelector('mapml-viewer');
            
            // CSS Parsing and implementing
            let rawTextCSS = cssEditor.getValue();
            let mapmlCSS = parser.parseFromString("<map-style>" + rawTextCSS + "</map-style>", "text/xml").querySelector('map-style');
            // Adding the CSS to each layer
            let layers = mapml.querySelectorAll('layer-');
            for (i=0; i<layers.length; ++i) {
                layers[i].appendChild(mapmlCSS);
            }
            // Adding code to output div
            let output = document.getElementById('output');
            output.appendChild(mapml);
        };

        // Function for switching between HTML and CSS
        function switchTab(evt, tab) {
            // Declare all variables
            let i, tabcontent, tablinks;

            // Get all elements with class="tabcontent" and hide them
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            // Get all elements with class="tablinks" and remove the class "active"
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }

            // Show the current tab, and add an "active" class to the button that opened the tab
            document.getElementById(tab).style.display = "inline-block";
            htmlEditor.refresh();
            cssEditor.refresh();
            evt.currentTarget.className += " active";
        }
        
        // Select The HTML Tab as the default
        document.getElementById('default').click();
    </script>
</body>
</html>
